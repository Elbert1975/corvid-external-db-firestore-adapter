<h1 align="center">
  Corvid Connector for Google Cloud Firestore
</h1>

This project allows to plug in [Google Cloud Firestore](https://cloud.google.com/firestore/) into [Corvid by Wix](https://www.wix.com/corvid) site and use it as a Corvid collection database. It is implemented as NodeJS server that can be deployed either to [Google Cloud Run](https://cloud.google.com/run/) or [AppEngine](https://cloud.google.com/appengine/). After Connector is deployed it can be used as [Corvid External Database](https://support.wix.com/en/article/corvid-adding-and-deleting-an-external-database-collection).


## Deploying to Cloud Run using Cloud Console

Follow instructions on the Google Cloud Run [quickstart guide](https://cloud.google.com/run/docs/quickstarts/prebuilt-deploy).
In the form of creating service,

1. Use **gcr.io/corvid-api/firestore-connector-node** as a container image.
2. Select Cloud Run **(fully managed)** as your development platform.
3. Select **us-east1** region.
4. Select **Allow unauthenticated invocations** to be able to access the connector from Corvid
5. Click *Create* to deploy the image to Cloud Run and wait for the deployment to finish.

Click the displayed URL link to test the deployed connector.
In the browser you should see
> {"message":"Missing request context"}

**This means that connector is running!** Copy the service URL, **this is the URL for connecting Firestore to Corvid site**

## Deployment to Google Cloud Run using gcloud CLI

* Install the [Google Cloud SDK](https://cloud.google.com/sdk/docs/quickstarts) for your operating system;
* Acquire local credentials;

    ```bash
    gcloud auth application-default login
    ```

* Set project you have created as default by running

    ```bash
    gcloud config set project PROJECTID
    ```

* Deploy the Corvid connector container

    ```bash
    gcloud run deploy --image gcr.io/corvid-api/firestore-connector-node --platform managed --region us-east1
    ```

  * Answer **y** when prompted "Allow unauthenticated invocations to [firestore-connector-node] (y/N)?"
  * After deployment is successful, you should see in the command output something like:

    > Service [firestore-connector-node] revision [firestore-connector-node-00001-nep] has been deployed and is serving 100 percent of traffic at <https://firestore-connector-node-[autogenerated].run.app>
  * Copy the service URL, **this is the URL for connecting Firestore to Corvid site**

## Deployment to Google App Engine using gcloud CLI

* Run deployment command in your connector project folder.

	```
	gcloud app deploy app.yaml
	```
* After deployment, access your service at `https://<project name>.appspot.com/`
